
-- LocalScript in StarterPlayerScripts or similar

local player = game.Players.LocalPlayer
local mouse = player:GetMouse()
local UIS = game:GetService("UserInputService")
local RS = game:GetService("RunService")
local gui = Instance.new("ScreenGui")
gui.Parent = player:WaitForChild("PlayerGui")
gui.Name = "CheatGUI"

-- Main Frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 450)  -- Increased height for new feature
frame.Position = UDim2.new(0.5, -100, 0.5, -225)
frame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
frame.BorderSizePixel = 0
frame.Active = true
frame.ClipsDescendants = true
frame.Parent = gui

-- Title Bar
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
titleBar.Parent = frame

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -30, 1, 0)
titleLabel.Position = UDim2.new(0, 0, 0, 0)
titleLabel.Text = "EUGENEIUM"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.BackgroundTransparency = 1
titleLabel.Parent = titleBar

-- Minimize Button
local minimizeButton = Instance.new("TextButton")
minimizeButton.Size = UDim2.new(0, 30, 1, 0)
minimizeButton.Position = UDim2.new(1, -30, 0, 0)
minimizeButton.Text = "-"
minimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
minimizeButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
minimizeButton.Parent = titleBar

local minimized = false
minimizeButton.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        frame.Size = UDim2.new(0, 200, 0, 30)
        minimizeButton.Text = "+"
    else
        frame.Size = UDim2.new(0, 200, 0, 450)
        minimizeButton.Text = "-"
    end
end)

-- Make GUI Draggable (compatible with mobile)
local dragging = false
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = frame.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

titleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UIS.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Content Frame
local content = Instance.new("Frame")
content.Size = UDim2.new(1, 0, 1, -30)
content.Position = UDim2.new(0, 0, 0, 30)
content.BackgroundTransparency = 1
content.Parent = frame

-- WalkSpeed
local wsLabel = Instance.new("TextLabel")
wsLabel.Size = UDim2.new(1, 0, 0, 30)
wsLabel.Text = "WalkSpeed: 16"
wsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
wsLabel.BackgroundTransparency = 1
wsLabel.Parent = content

local wsSlider = Instance.new("TextBox")
wsSlider.Size = UDim2.new(1, 0, 0, 30)
wsSlider.Position = UDim2.new(0, 0, 0, 30)
wsSlider.Text = "16"
wsSlider.Parent = content

wsSlider.FocusLost:Connect(function()
    local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid.WalkSpeed = tonumber(wsSlider.Text) or 16
        wsLabel.Text = "WalkSpeed: " .. humanoid.WalkSpeed
    end
end)

-- JumpPower
local jpLabel = Instance.new("TextLabel")
jpLabel.Size = UDim2.new(1, 0, 0, 30)
jpLabel.Position = UDim2.new(0, 0, 0, 60)
jpLabel.Text = "JumpPower: 50"
jpLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
jpLabel.BackgroundTransparency = 1
jpLabel.Parent = content

local jpSlider = Instance.new("TextBox")
jpSlider.Size = UDim2.new(1, 0, 0, 30)
jpSlider.Position = UDim2.new(0, 0, 0, 90)
jpSlider.Text = "50"
jpSlider.Parent = content

jpSlider.FocusLost:Connect(function()
    local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid.JumpPower = tonumber(jpSlider.Text) or 50
        jpLabel.Text = "JumpPower: " .. humanoid.JumpPower
    end
end)

-- Noclip Toggle
local noclipButton = Instance.new("TextButton")
noclipButton.Size = UDim2.new(1, 0, 0, 30)
noclipButton.Position = UDim2.new(0, 0, 0, 120)
noclipButton.Text = "Noclip: Off"
noclipButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
noclipButton.Parent = content

local noclip = false
local noclipConn

noclipButton.MouseButton1Click:Connect(function()
    noclip = not noclip
    if noclip then
        noclipButton.Text = "Noclip: On"
        noclipButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        noclipConn = RS.Stepped:Connect(function()
            if player.Character then
                for _, part in ipairs(player.Character:GetDescendants()) do
                    if part:IsA("BasePart") and part.CanCollide then
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        noclipButton.Text = "Noclip: Off"
        noclipButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
        if noclipConn then
            noclipConn:Disconnect()
        end
    end
end)

-- Fly Toggle
local flyButton = Instance.new("TextButton")
flyButton.Size = UDim2.new(1, 0, 0, 30)
flyButton.Position = UDim2.new(0, 0, 0, 150)
flyButton.Text = "Fly: Off"
flyButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
flyButton.Parent = content

local flying = false
local flySpeed = 50
local bodyGyro
local bodyVelocity
local inputBeganConn
local inputEndedConn
local renderSteppedConn
local controls = {
    forward = 0,
    backward = 0,
    left = 0,
    right = 0,
    up = 0,
    down = 0
}
local isMobile = UIS.TouchEnabled
local moveVector = Vector2.new(0, 0)

-- Fly Speed
local fsLabel = Instance.new("TextLabel")
fsLabel.Size = UDim2.new(1, 0, 0, 30)
fsLabel.Position = UDim2.new(0, 0, 0, 180)
fsLabel.Text = "FlySpeed: 50"
fsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
fsLabel.BackgroundTransparency = 1
fsLabel.Parent = content

local fsSlider = Instance.new("TextBox")
fsSlider.Size = UDim2.new(1, 0, 0, 30)
fsSlider.Position = UDim2.new(0, 0, 0, 210)
fsSlider.Text = "50"
fsSlider.Parent = content

fsSlider.FocusLost:Connect(function()
    flySpeed = tonumber(fsSlider.Text) or 50
    fsLabel.Text = "FlySpeed: " .. flySpeed
end)

-- ESP Toggle
local espButton = Instance.new("TextButton")
espButton.Size = UDim2.new(1, 0, 0, 30)
espButton.Position = UDim2.new(0, 0, 0, 240)
espButton.Text = "ESP: Off"
espButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
espButton.Parent = content

local esp = false
local espConnections = {}
local espHighlights = {}
local espBillboards = {}

local function createESP(plr)
    if plr == player or not plr.Character then return end
    
    -- Highlight
    local highlight = Instance.new("Highlight")
    highlight.Name = "ESPHighlight"
    highlight.Parent = plr.Character
    highlight.Adornee = plr.Character
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.OutlineTransparency = 0
    highlight.FillTransparency = 0.5
    
    local color = Color3.fromRGB(255, 255, 255)  -- Default white
    if plr.Team then
        color = plr.Team.TeamColor.Color
    end
    highlight.OutlineColor = color
    highlight.FillColor = color
    
    espHighlights[plr] = highlight
    
    -- Billboard for name
    local head = plr.Character:FindFirstChild("Head")
    if head then
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "ESP"
        billboard.Adornee = head
        billboard.Parent = head
        billboard.Size = UDim2.new(0, 200, 0, 50)
        billboard.StudsOffset = Vector3.new(0, 2, 0)
        billboard.AlwaysOnTop = true
        
        local text = Instance.new("TextLabel")
        text.Text = plr.Name
        text.Size = UDim2.new(1, 0, 1, 0)
        text.BackgroundTransparency = 1
        text.TextColor3 = color
        text.Parent = billboard
        
        espBillboards[plr] = billboard
    end
end

local function removeESP(plr)
    if espHighlights[plr] then
        espHighlights[plr]:Destroy()
        espHighlights[plr] = nil
    end
    if espBillboards[plr] then
        espBillboards[plr]:Destroy()
        espBillboards[plr] = nil
    end
end

espButton.MouseButton1Click:Connect(function()
    esp = not esp
    if esp then
        espButton.Text = "ESP: On"
        espButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        for _, plr in ipairs(game.Players:GetPlayers()) do
            createESP(plr)
        end
        espConnections.playerAdded = game.Players.PlayerAdded:Connect(function(plr)
            plr.CharacterAdded:Connect(function()
                createESP(plr)
            end)
        end)
        espConnections.playerRemoving = game.Players.PlayerRemoving:Connect(removeESP)
    else
        espButton.Text = "ESP: Off"
        espButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
        for _, plr in ipairs(game.Players:GetPlayers()) do
            removeESP(plr)
        end
        for _, conn in pairs(espConnections) do
            conn:Disconnect()
        end
        espConnections = {}
    end
end)

-- Infinite Jump Toggle
local infJumpButton = Instance.new("TextButton")
infJumpButton.Size = UDim2.new(1, 0, 0, 30)
infJumpButton.Position = UDim2.new(0, 0, 0, 270)
infJumpButton.Text = "Inf Jump: Off"
infJumpButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
infJumpButton.Parent = content

local infJump = false
local infJumpConn

infJumpButton.MouseButton1Click:Connect(function()
    infJump = not infJump
    if infJump then
        infJumpButton.Text = "Inf Jump: On"
        infJumpButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        infJumpConn = UIS.InputBegan:Connect(function(input, gameProcessed)
            if not gameProcessed and input.KeyCode == Enum.KeyCode.Space then
                local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end
        end)
    else
        infJumpButton.Text = "Inf Jump: Off"
        infJumpButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
        if infJumpConn then
            infJumpConn:Disconnect()
        end
    end
end)

-- TP Tool Button
local tpToolButton = Instance.new("TextButton")
tpToolButton.Size = UDim2.new(1, 0, 0, 30)
tpToolButton.Position = UDim2.new(0, 0, 0, 300)
tpToolButton.Text = "Get TP Tool"
tpToolButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
tpToolButton.Parent = content

local tpTool
tpToolButton.MouseButton1Click:Connect(function()
    if tpTool then tpTool:Destroy() end
    tpTool = Instance.new("Tool")
    tpTool.Name = "Teleport Tool"
    tpTool.Parent = player.Backpack
    
    local handle = Instance.new("Part")
    handle.Name = "Handle"
    handle.Size = Vector3.new(1, 1, 1)
    handle.Transparency = 1
    handle.Parent = tpTool
    
    tpTool.Activated:Connect(function()
        local char = player.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            char.HumanoidRootPart.CFrame = mouse.Hit + Vector3.new(0, 5, 0)
        end
    end)
end)

-- TP to Player
local tpPlayerLabel = Instance.new("TextLabel")
tpPlayerLabel.Size = UDim2.new(1, 0, 0, 30)
tpPlayerLabel.Position = UDim2.new(0, 0, 0, 330)
tpPlayerLabel.Text = "TP to Player:"
tpPlayerLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
tpPlayerLabel.BackgroundTransparency = 1
tpPlayerLabel.Parent = content

local tpPlayerBox = Instance.new("TextBox")
tpPlayerBox.Size = UDim2.new(1, 0, 0, 30)
tpPlayerBox.Position = UDim2.new(0, 0, 0, 360)
tpPlayerBox.Text = ""
tpPlayerBox.Parent = content

local tpPlayerButton = Instance.new("TextButton")
tpPlayerButton.Size = UDim2.new(1, 0, 0, 30)
tpPlayerButton.Position = UDim2.new(0, 0, 0, 390)
tpPlayerButton.Text = "Teleport"
tpPlayerButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
tpPlayerButton.Parent = content

tpPlayerButton.MouseButton1Click:Connect(function()
    local input = tpPlayerBox.Text:lower()
    if input == "" then return end
    for _, plr in ipairs(game.Players:GetPlayers()) do
        if plr ~= player and (plr.Name:lower():find(input, 1, true) == 1 or plr.DisplayName:lower():find(input, 1, true) == 1) then
            local char = player.Character
            local targetChar = plr.Character
            if char and targetChar and char:FindFirstChild("HumanoidRootPart") and targetChar:FindFirstChild("HumanoidRootPart") then
                char.HumanoidRootPart.CFrame = targetChar.HumanoidRootPart.CFrame + Vector3.new(0, 5, 0)
            end
            break
        end
    end
end)

-- Joystick for mobile
local joystickOuter = Instance.new("Frame")
joystickOuter.Name = "JoystickOuter"
joystickOuter.Size = UDim2.new(0, 150, 0, 150)
joystickOuter.Position = UDim2.new(0, 10, 1, -160)
joystickOuter.BackgroundColor3 = Color3.fromRGB(128, 128, 128)
joystickOuter.BackgroundTransparency = 0.5
joystickOuter.Active = true
joystickOuter.Parent = gui
joystickOuter.Visible = false

local outerCorner = Instance.new("UICorner")
outerCorner.CornerRadius = UDim.new(1, 0)
outerCorner.Parent = joystickOuter

local joystickThumb = Instance.new("Frame")
joystickThumb.Name = "JoystickThumb"
joystickThumb.AnchorPoint = Vector2.new(0.5, 0.5)
joystickThumb.Size = UDim2.new(0, 50, 0, 50)
joystickThumb.Position = UDim2.new(0.5, 0, 0.5, 0)
joystickThumb.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
joystickThumb.BackgroundTransparency = 0.5
joystickThumb.Parent = joystickOuter

local thumbCorner = Instance.new("UICorner")
thumbCorner.CornerRadius = UDim.new(1, 0)
thumbCorner.Parent = joystickThumb

-- Up/Down buttons for mobile
local upDownFrame = Instance.new("Frame")
upDownFrame.Name = "UpDownFrame"
upDownFrame.Size = UDim2.new(0, 100, 0, 150)
upDownFrame.Position = UDim2.new(1, -110, 1, -160)
upDownFrame.BackgroundTransparency = 1
upDownFrame.Parent = gui
upDownFrame.Visible = false

local function createFlyButton(name, pos, actionDown, actionUp)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, 0, 0, 50)
    btn.Position = pos
    btn.Text = name
    btn.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
    btn.Parent = upDownFrame
    btn.MouseButton1Down:Connect(actionDown)
    btn.MouseButton1Up:Connect(actionUp)
    return btn
end

createFlyButton("Up", UDim2.new(0, 0, 0, 0), function() controls.up = 1 end, function() controls.up = 0 end)
createFlyButton("Down", UDim2.new(0, 0, 0, 60), function() controls.down = 1 end, function() controls.down = 0 end)

-- Joystick handling
local currentTouch = nil
local maxDistance = 75

local function updateJoystick(input)
    local center = joystickOuter.AbsolutePosition + joystickOuter.AbsoluteSize * 0.5
    local position = Vector2.new(input.Position.X, input.Position.Y)
    local delta = position - center
    local distance = delta.Magnitude
    if distance > maxDistance then
        delta = delta.Unit * maxDistance
    end
    joystickThumb.Position = UDim2.new(0.5, delta.X, 0.5, delta.Y)
    moveVector = delta / maxDistance
end

joystickOuter.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch and flying and not currentTouch then
        currentTouch = input
        updateJoystick(input)
    end
end)

UIS.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch and input == currentTouch then
        updateJoystick(input)
    end
end)

UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch and input == currentTouch then
        currentTouch = nil
        joystickThumb.Position = UDim2.new(0.5, 0, 0.5, 0)
        moveVector = Vector2.new(0, 0)
    end
end)

local function startFly()
    local character = player.Character
    if not character then return end
    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
    
    bodyGyro = Instance.new("BodyGyro")
    bodyGyro.P = 9e4
    bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    bodyGyro.CFrame = humanoidRootPart.CFrame
    bodyGyro.Parent = humanoidRootPart
    
    bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    bodyVelocity.Parent = humanoidRootPart
    
    -- Reset controls
    for k in pairs(controls) do controls[k] = 0 end
    moveVector = Vector2.new(0, 0)
    
    -- Keyboard controls if not mobile
    if not isMobile then
        local keyMap = {
            [Enum.KeyCode.W] = "forward",
            [Enum.KeyCode.S] = "backward",
            [Enum.KeyCode.A] = "left",
            [Enum.KeyCode.D] = "right",
            [Enum.KeyCode.Space] = "up",
            [Enum.KeyCode.LeftControl] = "down",
        }
        
        inputBeganConn = UIS.InputBegan:Connect(function(input, gameProcessed)
            if gameProcessed then return end
            if input.UserInputType == Enum.UserInputType.Keyboard then
                local dir = keyMap[input.KeyCode]
                if dir then controls[dir] = 1 end
            end
        end)
        
        inputEndedConn = UIS.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.Keyboard then
                local dir = keyMap[input.KeyCode]
                if dir then controls[dir] = 0 end
            end
        end)
    end
    
    -- Render loop
    renderSteppedConn = RS.RenderStepped:Connect(function()
        if flying and bodyGyro and bodyVelocity then
            bodyGyro.CFrame = workspace.CurrentCamera.CFrame
            local camLook = workspace.CurrentCamera.CFrame.LookVector
            local camRight = workspace.CurrentCamera.CFrame.RightVector
            local moveX, moveY, moveZ
            if isMobile then
                moveX = moveVector.X
                moveZ = -moveVector.Y
                moveY = controls.up - controls.down
            else
                moveX = controls.right - controls.left
                moveY = controls.up - controls.down
                moveZ = controls.forward - controls.backward
            end
            local move = Vector3.new(moveX, moveY, moveZ)
            bodyVelocity.Velocity = (camLook * move.Z + camRight * move.X + Vector3.new(0, move.Y, 0)) * flySpeed
        end
    end)
    
    -- Show mobile controls if applicable
    if isMobile then
        joystickOuter.Visible = true
        upDownFrame.Visible = true
    end
end

local function stopFly()
    if bodyGyro then bodyGyro:Destroy() end
    if bodyVelocity then bodyVelocity:Destroy() end
    if inputBeganConn then inputBeganConn:Disconnect() end
    if inputEndedConn then inputEndedConn:Disconnect() end
    if renderSteppedConn then renderSteppedConn:Disconnect() end
    joystickOuter.Visible = false
    upDownFrame.Visible = false
    -- Reset controls
    for k in pairs(controls) do controls[k] = 0 end
    moveVector = Vector2.new(0, 0)
end

flyButton.MouseButton1Click:Connect(function()
    flying = not flying
    if flying then
        flyButton.Text = "Fly: On"
        flyButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        startFly()
    else
        flyButton.Text = "Fly: Off"
        flyButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
        stopFly()
    end
end)

-- Update on character added
player.CharacterAdded:Connect(function(char)
    if noclip then
        noclipConn = RS.Stepped:Connect(function()
            for _, part in ipairs(char:GetDescendants()) do
                if part:IsA("BasePart") and part.CanCollide then
                    part.CanCollide = false
                end
            end
        end)
    end
    if flying then
        stopFly()
        startFly()
    end
    if esp then
        for _, plr in ipairs(game.Players:GetPlayers()) do
            if plr.Character then
                createESP(plr)
            end
        end
    end
    -- Update labels
    local humanoid = char:WaitForChild("Humanoid")
    wsLabel.Text = "WalkSpeed: " .. humanoid.WalkSpeed
    wsSlider.Text = tostring(humanoid.WalkSpeed)
    jpLabel.Text = "JumpPower: " .. humanoid.JumpPower
    jpSlider.Text = tostring(humanoid.JumpPower)
end)

-- Initial ESP setup if players already loaded
if esp then
    for _, plr in ipairs(game.Players:GetPlayers()) do
        if plr.Character then
            createESP(plr)
        end
    end
end